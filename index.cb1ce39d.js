const e=document.querySelector(".button.start"),t=document.querySelector(".button.restart"),s=document.querySelectorAll(".field-row"),a=document.querySelectorAll(".field-cell"),i=document.querySelector(".message.message-win"),r=document.querySelector(".message.message-lose"),o=document.querySelector(".message.message-start"),n=document.querySelector(".game-score"),d=new class{constructor(e=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.initialState=e.map(e=>[...e]),Object.freeze(this.initialState),this.gameBoard=this.initialState.map(e=>[...e]),this.status="idle",this.score=0}start(){this.status="playing",this.generateTile(2)}restart(){this.gameBoard=this.initialState.map(e=>[...e]),this.status="idle",this.score=0}getStatus(){return this.status}getScore(){return this.score}getState(){return this.gameBoard}isGameBoardFull(){return this.gameBoard.flat().every(e=>0!==e)}generateTile(e=1){if(!this.isGameBoardFull())for(let t=0;t<e;t++){let e;do e=[Math.floor(4*Math.random()),Math.floor(4*Math.random())];while(0!==this.gameBoard[e[0]][e[1]])let t=.9>Math.random()?2:4;this.gameBoard[e[0]][e[1]]=t,this.checkForWin(),this.checkForLose()}}checkForWin(){for(let e of this.gameBoard)for(let t of e)2048===t&&(this.status="win")}checkForLose(){this.canMove()||(this.status="lose")}move(e){if("playing"===this.status){switch(e){case"left":this.moveLeft();break;case"right":this.moveRight();break;case"up":this.moveUp();break;case"down":this.moveDown()}this.checkForWin(),this.checkForLose()}}transposeState(e){let t=[];for(let s=0;s<4;s++){t[s]=[];for(let a=0;a<4;a++)t[s][a]=e[a][s]}return t}moveLeft(e=!0){if("playing"!==this.status)return;let t=!1;for(let e=0;e<this.gameBoard.length;e++){let s=this.shiftAndMerge(this.gameBoard[e]);s.join("")!==this.gameBoard[e].join("")&&(t=!0),this.gameBoard[e]=s}return e&&t&&this.generateTile(),t}moveRight(e=!0){if("playing"!==this.status)return;let t=!1;for(let e=0;e<this.gameBoard.length;e++){let s=this.gameBoard[e].slice().reverse(),a=this.shiftAndMerge(s).reverse();a.join("")!==this.gameBoard[e].join("")&&(t=!0),this.gameBoard[e]=a}return e&&t&&this.generateTile(),t}moveUp(){if("playing"!==this.status)return;this.gameBoard=this.transposeState(this.gameBoard);let e=this.moveLeft(!1);return this.gameBoard=this.transposeState(this.gameBoard),e&&this.generateTile(),e}moveDown(){if("playing"!==this.status)return;this.gameBoard=this.transposeState(this.gameBoard);let e=this.moveRight(!1);return this.gameBoard=this.transposeState(this.gameBoard),e&&this.generateTile(),e}shiftAndMerge(e){let t=e.filter(e=>0!==e);for(let e=0;e<t.length-1;e++)t[e]===t[e+1]&&(t[e]*=2,this.score+=t[e],t.splice(e+1,1));for(;t.length<4;)t.push(0);return t}canMove(){for(let e=0;e<this.gameBoard.length;e++)for(let t=0;t<this.gameBoard[e].length;t++)if(0===this.gameBoard[e][t]||t<3&&this.gameBoard[e][t]===this.gameBoard[e][t+1]||e<3&&this.gameBoard[e][t]===this.gameBoard[e+1][t])return!0;return!1}};function h(){switch(d.getState().forEach((e,t)=>{e.forEach((e,a)=>{s[t].children[a].innerHTML=e||""})}),a.forEach(e=>{e.className="field-cell",e.innerHTML&&e.classList.add(`field-cell--${e.innerHTML}`)}),n.innerHTML=d.getScore(),d.getStatus()){case"win":i.classList.remove("hidden"),r.classList.add("hidden"),o.classList.add("hidden");break;case"lose":r.classList.remove("hidden"),i.classList.add("hidden"),o.classList.add("hidden");break;case"playing":i.classList.add("hidden"),r.classList.add("hidden"),o.classList.add("hidden");break;default:o.classList.remove("hidden"),i.classList.add("hidden"),r.classList.add("hidden")}}e.addEventListener("click",function(){d.start(),e.classList.add("hidden"),t.classList.remove("hidden"),h(),document.addEventListener("keydown",c)}),t.addEventListener("click",function(){d.restart(),e.classList.remove("hidden"),t.classList.add("hidden"),h(),document.removeEventListener("keydown",c)});let l=!1;function c(e){if("playing"===d.getStatus()&&!l){switch(l=!0,e.key){case"ArrowLeft":d.moveLeft();break;case"ArrowRight":d.moveRight();break;case"ArrowUp":d.moveUp();break;case"ArrowDown":d.moveDown();break;default:l=!1;return}d.checkForWin(),d.checkForLose(),h(),"playing"!==d.getStatus()&&document.removeEventListener("keydown",c)}}document.addEventListener("keydown",c),document.addEventListener("keyup",function(){l=!1});
//# sourceMappingURL=index.cb1ce39d.js.map
